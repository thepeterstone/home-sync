#!/bin/zsh

# We're located in bin/
ROOT=$(cd $(dirname $(dirname $0)); pwd)

main() {
    rm -rf $ROOT/backups; mkdir $ROOT/backups

    for file in $(ls $ROOT/dot-files); do
        echo "Updating [0;32m$file[0m..."
        backupAndReplace $file
    done

    if [ -z "$(grep 'added by home-sync' ~/.zshrc)" ]; then
      echo "export PATH=\"\$PATH:$ROOT/bin\" # added by home-sync" >> ~/.zshrc
      echo "~/.zsrhc updated - source it to apply changes."
    fi
}

backupAndReplace() {
    [ -e $HOME/.$1 ] && mv -f $HOME/.$1 $ROOT/backups/$1
    # this needs to be forced because -e returns false for a dangling symlink
    ln -sf $ROOT/dot-files/$1 $HOME/.$1
}

main
